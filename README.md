# RunlogAnalyzer

日志分析并生成excel。

主要用于分析水质仪器日志，捕捉测量开始结束信号，通过正则匹配信息后统计。

<img src="D:\share_dir\product_env\01.SVN\01.local_git\WaterRunlogAnalyzer\README.assets\tip01.png" style="zoom: 67%;" />

### 使用指导

【日志选择】

打开文件选择器选择将要分析的日志文件，可同时选择多个日志。

【输出到表格】

用于选择输出excel的路径，若输入为空或输入路径为一个文件夹，则将所有日志分别输出到日志名.lxsx的表格中；若输入为已存在的.lxsx表格中，将会在该表格中建立日志名称的Sheet页，将结果输出到对应的Sheet页。

【执行】

点击后执行日志分析，进度显示在左下侧的输出框中。

【载入配置】

选择配置的json文件加载，配置中包含匹配表达式

【导出配置】

将当前的匹配表达式保存为json文件



## 工作原理

程序打开对应日志文件后，置in_session标志为False逐行扫描，若in_session标志为False且匹配到【起始匹配】的表达式，则置in_session标志为True，表明一次统计开始；

若in_session为True, 则会匹配【结束匹配】的表达式，若匹配成功，则会置in_session标志为False，表明一次统计结束，Excel表格写入指针下移一行;并开始等待匹配下一个【起始匹配】。

在in_seesion为True的扫描期间，会存在一个待匹配池，内包含所有待匹配的项目，这些项目即对应【匹配表达式】的各行，包含(列名称，匹配表达式， 匹配序号， 匹配跳过次数)。

读取一行时，逐个取出待匹配池中的一项，首先用匹配表达式匹配该行，若匹配不成功则继续取下一项；若匹配成功，匹配跳过次数减一，若匹配跳过次数小于0，表明匹配成立，将匹配到的对应匹配序号的字符串写入excel表对应列名称、当前行的单元格内，并在匹配池中删除该项，否则匹配不成立开始下一项。

若in_session变为False，则会生成新的匹配池，开始等待新一轮匹配。



## 程序文件

analyzer.py

实现匹配程序功能的接口，使用openpyxl库完成excel的写入。



main.py

界面实现，使用pyside2库，编写qt界面。